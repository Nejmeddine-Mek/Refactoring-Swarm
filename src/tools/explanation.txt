===========================================
Refactoring Swarm â€“ Toolsmith Documentation
===========================================

Role: Toolsmith
Purpose: Explain all implemented tools, helpers, and workflows for teammates.

-------------------------------------------
1ï¸âƒ£ Overview
-------------------------------------------
As the Toolsmith, I implemented:

- File handling (read/write/backup) with encoding support
- CLI tools to prepare Python files for agents
- Helpers to run pylint & pytest for analysis
- Self-healing loop simulation (dummy agent)
- Logging & sandbox safety

Key principles:

- All operations confined to sandbox
- File size limits enforced
- Backup before modification
- Logs fully structured for experiment tracking

-------------------------------------------
2ï¸âƒ£ File Structure
-------------------------------------------
/src
 â”œâ”€â”€ tools
 â”‚    â”œâ”€â”€ file_tools.py       # File read/write/backup
 â”‚    â”œâ”€â”€ cli_tools.py        # CLI args, payload preparation
 â”‚    â””â”€â”€ analysis_tools.py   # Wrappers for pylint & pytest
 â””â”€â”€ utils
      â””â”€â”€ logger.py           # Logging system (experiment tracking)

/sandbox          # Folder for temporary testing & safe modifications
/main.py          # Orchestrator using all Toolsmith tools

-------------------------------------------
3ï¸âƒ£ Key Functions
-------------------------------------------

ğŸ“„ File Tools
-------------
- read_file(file_path) â†’ returns file content
- write_file(file_path, content) â†’ writes content safely
- backup_file(file_path) â†’ creates backup before changes

ğŸ“„ CLI Tools
------------
- parse_args() â†’ handles CLI arguments
- prepare_payloads(target_dir, max_file_size) â†’ reads all Python files, skips large files

ğŸ“„ Analysis Tools
-----------------
- run_pylint(file_path) â†’ lints a Python file
- run_pytest(dir_path) â†’ runs pytest on directory

ğŸ“„ Dummy Agent
---------------
- dummy_agent(file_path, code) â†’ simulates agent changes
  Example output:
  # Fixed by dummy_agent
  <original code>

ğŸ“„ Self-Healing Loop
--------------------
- attempt_fix(file_path, code, max_iterations)
  - Iteratively applies dummy_agent
  - Runs pylint & pytest
  - Logs each iteration
  - Stops if tests pass

-------------------------------------------
4ï¸âƒ£ Logging Integration
-------------------------------------------
All actions logged via log_experiment:

Required fields: agent_name, model_used, action, details, status

details must include:
- input_prompt
- output_response

Example:

log_experiment(
    "DummyAgent",
    "test",
    ActionType.ANALYSIS,
    {
        "file": "sandbox/sample.py",
        "iteration": 1,
        "input_prompt": "Simulated agent prompt",
        "output_response": new_code
    },
    "SUCCESS"
)

-------------------------------------------
5ï¸âƒ£ Sandbox & Safety
-------------------------------------------
- All write operations restricted to sandbox folder
- Skips files exceeding max_file_size
- Multiple encoding support (UTF-8, UTF-8-SIG, Latin1)
- Backups made before changes

-------------------------------------------
6ï¸âƒ£ How to Test
-------------------------------------------
1. Activate virtual environment:
   Windows:
      .\venv\Scripts\activate
   Mac/Linux:
      source venv/bin/activate
   Install dependencies:
      pip install -r requirements.txt

2. Prepare sandbox with Python files:
   sandbox/test_main/sample.py

3. Run main:
   python main.py --target_dir "sandbox/test_main" --max_iterations 3 --max_file_size 1000000

4. Expected results:
   - File read correctly
   - Dummy agent prepends comment
   - Logs created in logs/experiment_data.json
   - Self-healing loop executes iterations

-------------------------------------------
7ï¸âƒ£ Quick Flow Diagram
-------------------------------------------
Python files â†’ prepare_payloads() â†’ sandbox-safe code list
       â†“
   For each file:
       â†“
   attempt_fix()
       â†“
   dummy_agent applied â†’ write_file() â†’ backup_file()
       â†“
   run_pylint() & run_pytest()
       â†“
   log_experiment()
       â†“
   âœ… Success or âŒ Retry
       â†“
   Repeat max_iterations

-------------------------------------------
8ï¸âƒ£ Notes for Teammates
-------------------------------------------
- Prompt Engineer: Use payloads for LLM prompts
- Orchestrator: Use attempt_fix() for self-healing loop
- Data Manager: Check experiment_data.json for logs
- Toolsmith caution: Do not rename functions without notifying team

-------------------------------------------
âœ… Status: Toolsmith work complete
-------------------------------------------
